import{d as z,h as j,l as C,k as b,c as x,w as O,a as l,b as t,e as a,g as e,y as U,t as u,n as i,f as h,z as de,j as me,A as pe,p as ge,r as E,o as ve,m as H,H as fe,I as he,F as be,G as ke,L as Me,N as ye}from"./index-4405b5ba.js";import{_ as Pe}from"./index.vue_vue_type_script_setup_true_lang-c5acbf2f.js";import{_ as Ce}from"./memberData.vue_vue_type_script_setup_true_lang-21b6be4e.js";import{_ as Re}from"./index.vue_vue_type_script_setup_true_lang-e29cff9c.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-849de14f.js";import"./SearchBox.vue_vue_type_script_setup_true_lang-a6a08cb4.js";import"./index.vue_vue_type_script_setup_true_lang-5a95ef0c.js";const Se={key:0},we={class:"flex-center-page rou-page popBtn"},De=e("i",{class:U(["fas","fa fa-image"])},null,-1),Ie={class:"rou-text"},$e=e("i",{class:U(["fas","fa fa-camera-retro"])},null,-1),Ue={class:"rou-text"},Te={key:1},Ae=["src"],xe={key:1,class:"errorMsg"},Be={key:2,class:"videoAndCanvas"},Ne={key:3},Fe=["src"],Ve={key:4},Le={class:"errorMsg"},Oe={key:5},Ee={class:"errorMsg",style:{color:"black"}},He={key:6},ze={class:"errorMsg"},je=e("i",{class:"fas fa-undo-alt"},null,-1),Ye=e("i",{class:"fas fa-undo-alt"},null,-1),Ge=e("i",{class:"fas fa-check"},null,-1),We=e("i",{class:"fas fa-undo-alt"},null,-1),qe=e("i",{class:"fas fa-check"},null,-1),Je=e("i",{class:"fas fa-undo-alt"},null,-1),Ke=e("i",{class:"fas fa-check"},null,-1),Qe=e("i",{class:"fas fa-undo-alt"},null,-1),Xe=e("i",{class:"fas fa-undo-alt"},null,-1),Ze=e("i",{class:"fas fa-check"},null,-1),et=e("i",{class:"fas fa-check"},null,-1),tt=e("i",{class:"fas fa-check"},null,-1),nt=z({__name:"SettingPopup",props:{outImage:null,pop:null},emits:["back","confirmImage","yesSubmit","doneSubmit"],setup(s,{emit:o}){const r=s,{t:n}=j(),R=C(null),p=C(null),w=C(null),c=C(null),v=C(null),B=b(()=>n("PointManagment.PointRegistration.showMsg.Formatdoesnotmatch")),N=b(()=>n("PointManagment.PointRegistration.showMsg.AmountOver")),D=b(()=>n("PointManagment.PointRegistration.showMsg.SubmitSuccess")),M=()=>{c.value.click()},y=()=>{const g=c.value.files.item(0);if(r.pop.step=2,r.pop.css="pointRegistrationPop",r.pop.title=n("PointManagment.PointRegistration.alertTitle.UploadSuccess"),g.type.indexOf("image/")==-1){r.pop.title=n("PointManagment.PointRegistration.alertTitle.UploadError"),v.value=null;return}const m=new FileReader;m.addEventListener("load",P=>{v.value=P.target.result}),m.readAsDataURL(g)},_=()=>{r.pop.title=n("PointManagment.PointRegistration.alertTitle.Chooseuploadmethod"),r.pop.step=1,r.pop.css=""},k=()=>{o("confirmImage",v.value),_()},d=()=>{v.value=null,p.value&&(p.value.width=0+"px",p.value.height=0+"px"),w.value.getTracks().forEach(g=>g.stop()),r.pop.title=n("PointManagment.PointRegistration.alertTitle.Chooseuploadmethod"),r.pop.step=1,r.pop.css=""},T=async()=>{v.value=null,p.value&&(p.value.width=0+"px",p.value.height=0+"px"),r.pop.step=3,r.pop.title="",r.pop.css="pointRegistrationPop",await navigator.mediaDevices.getUserMedia({video:!0}).then(function(g){w.value=g,R.value.srcObject=g}).catch(function(g){console.log(g.message,g.name)})},A=()=>{r.pop.title=n("PointManagment.PointRegistration.alertTitle.UploadSuccess"),p.value.width=R.value.videoWidth,p.value.height=R.value.videoHeight,p.value.getContext("2d").drawImage(R.value,0,0,p.value.width,p.value.height),w.value.getTracks().forEach(m=>m.stop());const g=p.value.toDataURL();v.value=g};return(g,m)=>s.pop.value?(t(),x(_e,{key:0,title:s.pop.title,content:s.pop.content,css:s.pop.css},{content:O(()=>[s.pop.step==1?(t(),a("div",Se,[e("div",we,[e("div",{class:U(["rou","pink"]),onClick:M},[De,e("div",Ie,u(i(n)("button.image")),1)]),e("div",{class:U(["rou","gray"]),onClick:T},[$e,e("div",Ue,u(i(n)("button.camera")),1)])]),e("input",{id:"uploadInputFile",ref_key:"inputFileDom",ref:c,type:"file",accept:"image/*",onChange:y},null,544)])):l("",!0),s.pop.step==2?(t(),a("div",Te,[v.value?(t(),a("img",{key:0,class:"previewImage",src:v.value,width:"200"},null,8,Ae)):(t(),a("p",xe,u(i(B)),1))])):l("",!0),s.pop.step==3?(t(),a("div",Be,[e("video",{class:"myVideo",ref_key:"myVideo",ref:R,playsinline:"",autoplay:"",muted:""},null,512),e("canvas",{class:"myCanvas",ref_key:"myCanvas",ref:p},null,512)])):l("",!0),s.pop.step==4?(t(),a("div",Ne,[s.outImage?(t(),a("img",{key:0,class:"previewImage",src:s.outImage,width:"200"},null,8,Fe)):l("",!0)])):l("",!0),s.pop.step==5?(t(),a("div",Ve,[e("p",Le,u(i(N)),1)])):l("",!0),s.pop.step==6?(t(),a("div",Oe,[e("p",Ee,u(i(D)),1)])):l("",!0),s.pop.step==7?(t(),a("div",He,[e("p",ze,u(r.pop.errorMsg),1)])):l("",!0)]),"btn-content":O(()=>[s.pop.step==1?(t(),a("div",{key:0,class:"btn",onClick:m[0]||(m[0]=P=>o("back"))},[je,h(u(i(n)("button.cancel")),1)])):l("",!0),s.pop.step==2?(t(),a("div",{key:1,class:"btn",onClick:_},[Ye,h(u(i(n)("button.back")),1)])):l("",!0),s.pop.step==2?(t(),a("div",{key:2,class:"btn btn-red",onClick:k},[Ge,h(u(i(n)("button.confirm")),1)])):l("",!0),s.pop.step==3&&!v.value?(t(),a("div",{key:3,class:"btn",onClick:d},[We,h(u(i(n)("button.back")),1)])):l("",!0),s.pop.step==3&&!v.value?(t(),a("div",{key:4,class:"btn btn-red",onClick:A},[qe,h(u(i(n)("button.getPhoto")),1)])):l("",!0),s.pop.step==3&&v.value?(t(),a("div",{key:5,class:"btn",onClick:d},[Je,h(u(i(n)("button.back")),1)])):l("",!0),s.pop.step==3&&v.value?(t(),a("div",{key:6,class:"btn btn-red",onClick:k},[Ke,h(u(i(n)("button.confirm")),1)])):l("",!0),s.pop.step==4?(t(),a("div",{key:7,class:"btn",onClick:m[1]||(m[1]=P=>o("back"))},[Qe,h(u(i(n)("button.back")),1)])):l("",!0),s.pop.step==5?(t(),a("div",{key:8,class:"btn",onClick:m[2]||(m[2]=P=>o("back"))},[Xe,h(u(i(n)("button.furtherReview")),1)])):l("",!0),s.pop.step==5?(t(),a("div",{key:9,class:"btn btn-red",onClick:m[3]||(m[3]=P=>o("yesSubmit"))},[Ze,h(u(i(n)("button.yesSubmit")),1)])):l("",!0),s.pop.step==6?(t(),a("div",{key:10,class:"btn btn-red",onClick:m[4]||(m[4]=P=>o("doneSubmit"))},[et,h(u(i(n)("button.done")),1)])):l("",!0),s.pop.step==7?(t(),a("div",{key:11,class:"btn btn-red",onClick:m[5]||(m[5]=P=>o("back"))},[tt,h(u(i(n)("button.ok")),1)])):l("",!0)]),_:1},8,["title","content","css"])):l("",!0)}}),ot={class:"PointRegistration"},at={class:"searchBox"},st={class:"showAllData"},it={class:"showImage"},lt={key:1},ut=["onClick"],rt={key:0,class:"page-err-mes prMsg"},ct={class:"btn-box"},dt=e("i",{class:"fas fa-angle-right"},null,-1),Mt=z({__name:"index",setup(s){const{t:o}=j(),r=de(),{doUserField:n,memberIDValue:R,getMemberBoolean:p}=me(),{handleValidate:w}=pe(),{pop:c,commonsSaveHandle:v,commonsSaveSuccess:B,commonsSaveFalse:N,closePop:D}=ge(),M=C(""),y=C(null),_=C(!1),k=C(!0);let d=E({Location:{value:"",err:"",field:"Location"},Amount:{value:"",err:"",field:"Amount"},RegisterDate:{value:"",err:"",field:"RegisterDate"},PaymentMethod:{value:"",err:"",field:"PaymentMethod"},TenantCode:{value:"",err:"",field:"TenantCode"},BusinessUnit:{value:"",err:"",field:"BusinessUnit"},ReceiptID:{value:"",err:"",field:"ReceiptID"}});const T=E({data:{Location:[{id:"1",name:"locationOption1"},{id:"2",name:"locationOption2"},{id:"3",name:"locationOption3"}],TenantCode:[{id:"1",name:"CU-001"},{id:"2",name:"CU-002"},{id:"3",name:"CU-003"}],PaymentMethod:[{id:"1",name:"Credit Cards"},{id:"2",name:"Cash"}]}});ve(()=>{ie()});const A=b(()=>y.value?o("button.retry"):o("button.upload")),g=b(()=>o("PointManagment.PointRegistration.showMsg.Default")),m=b(()=>o("PointManagment.PointRegistration.showMsg.moreDay14")),P=b(()=>o("PointManagment.PointRegistration.showMsg.SelectMemberID")),Y=b(()=>o("PointManagment.PointRegistration.showMsg.UploadPicture")),G=b(()=>o("PointManagment.PointRegistration.showMsg.AmountUnder")),W=b(()=>o("PointManagment.PointRegistration.showMsg.NotNumberMsg")),q=b(()=>({Location:n(o("PointManagment.PointRegistration.field.Location"),"d",!0,k.value),Amount:n(o("PointManagment.PointRegistration.field.Amount"),"i",!0,k.value),RegisterDate:n(o("PointManagment.PointRegistration.field.RegisterDate"),"date",!0,k.value),PaymentMethod:n(o("PointManagment.PointRegistration.field.PaymentMethod"),"d",!0,k.value),TenantCode:n(o("PointManagment.PointRegistration.field.TenantCode"),"d",!0,k.value),BusinessUnit:n(o("PointManagment.PointRegistration.field.BusinessUnit"),"i",!0,k.value),ReceiptID:n(o("PointManagment.PointRegistration.field.ReceiptID"),"i",!0,k.value)})),J=b(()=>({backgroundImage:"url('"+y.value+"')"})),K=f=>{d[f.field].value=f.value,w(d[f.field]).then(I=>{const{isSuccess:$,data:S}=I;d[f.field].err=$?"":S})},Q=()=>{if(M.value="",_.value===!1){M.value=P;return}if(y.value===null){M.value=Y;return}if(isNaN(d.Amount.value)){M.value=W,d.Amount.err=" ";return}const f=new Date,I=f.getFullYear(),$=f.getMonth()+1,S=f.getDate();if(Date.parse(new Date(`${I}/${$}/${S}`).toString())-Date.parse(new Date(d.RegisterDate.value.replace(/-/g,"/")).toString())>14*24*3600*1e3){M.value=m;return}let V=0;for(let L in d)w(d[L]).then(le=>{const{isSuccess:ue,data:re}=le;if(d[L].err=ue?"":re,V+=1,V==Object.keys(d).length&&!Object.values(d).some(ce=>ce.err)){if(Number(d.Amount.value)<=50){d.Amount.err=" ",M.value=G;return}if(Number(d.Amount.value)>=1e4){c.step=5,c.title=o("PointManagment.PointRegistration.alertTitle.RUSure"),c.value=!0,c.css="";return}F()}})},X=()=>{c.step=1,c.title=o("PointManagment.PointRegistration.alertTitle.Chooseuploadmethod"),c.value=!0,c.css=""},Z=()=>{D()},ee=f=>{y.value=f,D()},te=()=>{y.value!==null&&(c.step=4,c.title=o("PointManagment.PointRegistration.alertTitle.View"),c.value=!0,c.css="pointRegistrationPop")},ne=()=>{D(),F()},F=()=>{console.log(d),console.log("submitData"),c.value=!0,c.css="",c.step=6,c.title=o("PointManagment.PointRegistration.alertTitle.SubmitSuccess")},oe=()=>{D()},ae=f=>{r.setMemberInfo(f),_.value=!0},se=()=>{_.value=!1,r.setMemberInfo(r.nullMemberInfo)},ie=()=>{r.setMemberInfo(r.nullMemberInfo)};return(f,I)=>(t(),a("div",ot,[e("div",at,[H(Pe,{value:i(R),closeTable:i(p),onSearch:se,onClick:ae},null,8,["value","closeTable"]),i(p)?(t(),x(Ce,{key:0})):l("",!0)]),fe(e("section",null,[e("div",st,[e("form",null,[(t(!0),a(be,null,ke(i(q),($,S)=>(t(),x(Re,{key:S,label:$,value:i(d)[S],items:T.data[S],onChange:K},null,8,["label","value","items"]))),128))]),e("div",it,[e("div",{onClick:te},[e("div",{class:U([y.value?"nonebg":""])},[y.value?(t(),a("div",{key:0,class:"OutpreviewImage",style:Me(i(J))},null,4)):(t(),a("p",lt,u(i(g)),1))],2)]),e("button",{onClick:ye(X,["stop"])},u(i(A)),9,ut)])]),M.value?(t(),a("div",rt,u(M.value),1)):l("",!0),e("div",ct,[k.value?(t(),a("div",{key:0,class:"btn btn-red",onClick:I[0]||(I[0]=$=>Q())},[dt,h(u(i(o)("button.submit")),1)])):l("",!0)])],512),[[he,_.value]]),H(nt,{outImage:y.value,pop:i(c),onBack:Z,onYesSubmit:ne,onConfirmImage:ee,onDoneSubmit:oe},null,8,["outImage","pop"])]))}});export{Mt as default};
