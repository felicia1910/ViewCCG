import{d as D,h as K,z as A,o as B,b as c,e as u,g as e,t as s,n,u as N,m as w,w as g,f,y as d,a as _,F as E,v as M,G as O,c as C,H as x,I as z,j as W,p as pe,l as V,r as J,k as S,D as be,J as fe}from"./index-4405b5ba.js";import{_ as ve}from"./index.vue_vue_type_script_setup_true_lang-c5acbf2f.js";import{_ as _e}from"./group.vue_vue_type_script_setup_true_lang-d6310068.js";import{_ as he}from"./index.vue_vue_type_script_setup_true_lang-6d6179e0.js";import{_ as $e}from"./index.vue_vue_type_script_setup_true_lang-849de14f.js";import"./SearchBox.vue_vue_type_script_setup_true_lang-a6a08cb4.js";import"./index.vue_vue_type_script_setup_true_lang-5a95ef0c.js";const Re={class:"member-data"},ke={class:"line"},we={class:"line"},Pe={class:"line"},Ie={class:"line"},ye=D({__name:"memberData",setup(r){const{t:m}=K(),l=A();return B(()=>{}),(a,p)=>(c(),u("div",Re,[e("div",ke,s(n(m)("MemberProfile.field.MemberName"))+" :"+s(n(l).memberInfo.memberName.tc),1),e("div",we,s(n(m)("MemberProfile.field.point"))+" :"+s(n(l).memberInfo.point),1),e("div",Pe,s(n(m)("MemberProfile.field.PhoneNo"))+" :"+s(n(l).memberInfo.phoneNo),1),e("div",Ie,s(n(m)("MemberProfile.field.Email"))+" :"+s(n(l).memberInfo.Email),1)]))}}),Ce={class:"TableBoxZone reward-pick-table"},ge={class:"horizon"},De={class:d(["small-box"])},Be={class:"title"},Te=["onClick"],Ve=e("i",{class:"fas fa-times"},null,-1),Se={class:d(["small-box"])},Me={class:"title"},Ne={class:d(["value"])},Qe={class:d(["small-box"])},Ee={class:"title"},xe={class:d(["value"])},ze={class:d(["small-box"])},Ae={class:"title"},Fe={class:d(["value"])},He={class:d(["small-box"])},qe={class:"title"},Ue={class:d(["value"])},Ge={class:"total"},Le={key:0,class:"page-err-mes"},je={class:"btn-box"},Je=e("i",{class:"fas fa-eraser"},null,-1),Ke=e("i",{class:"fas fa-check"},null,-1),Oe=D({__name:"pickTable",props:{tableData:null,total:null,mes:null},emits:["keyup","del","clean","submit"],setup(r,{emit:m}){const l=r,a=A();N();const p=o=>{l.tableData[o].Quantity||(l.tableData[o].Quantity=1,m("keyup",o))};return B(()=>{}),(o,h)=>{const b=M("el-input-number"),F=M("el-scrollbar");return c(),u(E,null,[w(F,{class:"pick-table-list"},{default:g(()=>[e("div",Ce,[(c(!0),u(E,null,O(r.tableData,(R,P)=>(c(),u("div",{class:d(["tableBox-horizon tableBox-horizon-one"]),key:P},[e("div",ge,[e("div",De,[e("div",Be,s(o.$t("RedemptionRewards.Rewardlist.field.Item")),1),e("div",{class:d(["value cursor"]),onClick:k=>o.$emit("del",P)},[Ve,f(s(P+1),1)],8,Te)]),e("div",Se,[e("div",Me,s(o.$t("RedemptionRewards.Rewardlist.field.Productname")),1),e("div",Ne,s(R.Productname),1)]),e("div",Qe,[e("div",Ee,s(o.$t("RedemptionRewards.Rewardlist.field.Quantity")),1),e("div",xe,[w(b,{modelValue:R.Quantity,"onUpdate:modelValue":k=>R.Quantity=k,min:1,onChange:k=>o.$emit("keyup",P),onBlur:k=>p(P)},null,8,["modelValue","onUpdate:modelValue","onChange","onBlur"])])]),e("div",ze,[e("div",Ae,s(o.$t("RedemptionRewards.Rewardlist.field.Point")),1),e("div",Fe,s(R.Point),1)]),e("div",He,[e("div",qe,s(o.$t("RedemptionRewards.Rewardlist.field.ToTal")),1),e("div",Ue,s(R.ToTal),1)])])]))),128))])]),_:1}),e("div",Ge,[f(s(o.$t("RedemptionRewards.Rewardlist.field.ToTal"))+" ",1),e("span",{class:d(["text-green",Number(n(a).memberInfo.point)<r.total&&"text-red"])}," "+s(r.total),3)]),l.mes?(c(),u("div",Le,s(l.mes),1)):_("",!0),e("div",je,[e("div",{class:"btn btn-red btn-small",onClick:h[0]||(h[0]=R=>o.$emit("clean"))},[Je,f(s(o.$t("button.deleteAll")),1)]),e("div",{class:"btn btn-small",onClick:h[1]||(h[1]=R=>o.$emit("submit"))},[Ke,f(s(o.$t("button.confirmPoint")),1)])])],64)}}}),We={class:"product-list-box"},Ze=["onClick"],Xe={class:"product-card-head"},Ye={class:"name"},et={class:"detail-box"},tt=e("i",{class:"fas fa-gem"},null,-1),st=e("i",{class:"fas fa-boxes"},null,-1),ot={class:"product-card-bottom"},nt=D({__name:"ShopList",props:{items:null},emits:["click"],setup(r,{emit:m}){return N(),B(()=>{}),(l,a)=>{const p=M("el-scrollbar");return c(),C(p,{class:"product-list"},{default:g(()=>[e("div",We,[(c(!0),u(E,null,O(r.items,(o,h)=>x((c(),u("div",{class:d(["product-card",o.click&&"product-card-click",o.disabled&&"product-card-disabled",o.noPoint&&"product-card-no-point",!o.disabled&&"cursor"]),key:h,onClick:b=>m("click",o,h)},[e("div",Xe,[e("div",Ye,s(o.InvoiceNo),1),e("div",et,[e("p",null,[tt,f(s(o.Point),1)]),e("p",null,[st,f(s(o.Quantity),1)])])]),e("div",ot,s(o.click?l.$t("button.selected"):l.$t("button.select")),1)],10,Ze)),[[z,o.show]])),128))])]),_:1})}}}),at={key:0,class:"pop-content"},lt={class:"text-green"},it={key:1,class:"pop-content"},rt=e("br",null,null,-1),ct=e("br",null,null,-1),dt={class:"text-green"},ut=e("i",{class:"fas fa-undo-alt"},null,-1),mt=e("i",{class:"fas fa-check"},null,-1),pt=e("i",{class:"fas fa-check"},null,-1),bt=D({__name:"SettingPopup",props:{pop:null,point:null},emits:["back","check","saveBack"],setup(r,{emit:m}){return N(),W(),B(()=>{}),(l,a)=>r.pop.value?(c(),C($e,{key:0,title:r.pop.title,css:r.pop.css},{content:g(()=>[r.pop.step==1?(c(),u("div",at,[f(s(l.$t("RedemptionRewards.Rewardlist.popValue.step1Value"))+" "+s(l.$t("RedemptionRewards.Rewardlist.field.ToTal"))+": ",1),e("span",lt,s(r.point),1)])):_("",!0),r.pop.step==2?(c(),u("div",it,[f(s(r.pop.content),1),rt,f(" "+s(l.$t("RedemptionRewards.Rewardlist.popValue.step2Value1")),1),ct,f(" "+s(l.$t("RedemptionRewards.Rewardlist.popValue.step2Value2"))+" ",1),e("span",dt,s(r.point),1)])):_("",!0)]),"btn-content":g(()=>[r.pop.step==1?(c(),u("div",{key:0,class:"btn",onClick:a[0]||(a[0]=p=>m("back"))},[ut,f(s(l.$t("button.no")),1)])):_("",!0),r.pop.step==1?(c(),u("div",{key:1,class:"btn btn-red",onClick:a[1]||(a[1]=p=>m("check"))},[mt,f(s(l.$t("button.yes")),1)])):_("",!0),r.pop.step==2?(c(),u("div",{key:2,class:"btn btn-red",onClick:a[2]||(a[2]=p=>m("saveBack"))},[pt,f(s(l.$t("button.ok")),1)])):_("",!0)]),_:1},8,["title","css"])):_("",!0)}}),ft={class:"left"},vt={class:"rigth-box-fas"},_t={class:"label-spec"},ht={class:"label-spec"},Ct=D({__name:"index",setup(r){const m=N(),{t:l}=K(),a=A(),{forRewardWidth:p,getMemberBoolean:o,memberIDValue:h}=W(),{pop:b,commonsSaveHandle:F,commonsSaveSuccess:R,commonsSaveFalse:P,closePop:k}=pe(),H=V(""),Z=V(0),I=V(0),Q=V(!1),X=[],q=J({arr:[{ProductID:"31317B84-2573-4E18-A859-5D3B84FCFC2D",InvoiceNo:"RR20200319120701",Quantity:1,Point:100,Remark:"Bad quality",CreationDate:"19/03/20 12:07:10"},{ProductID:"824958CC-6E89-4E11-852D-49D0E3045B96",InvoiceNo:"RR20200319120701",Quantity:2,Point:250,Remark:"Bad quality",CreationDate:"19/03/20 13:07:10"},{ProductID:"49D0E3045B96",InvoiceNo:"RR2020",Quantity:2,Point:7e4,Remark:"Bad quality",CreationDate:"19/03/20 13:07:10"}]}),v=J({arr:[]}),Y=S(()=>[{name:l("RedemptionRewards.Rewardlist.field.All"),id:0,color:"black",click:I.value==0},{name:l("RedemptionRewards.Rewardlist.field.CannotRedeem"),id:1,color:"gray",click:I.value==1},{name:l("RedemptionRewards.Rewardlist.field.Available"),id:2,color:"green",click:I.value==2}]),U=S(()=>q.arr.map(t=>{let i=v.arr.findIndex($=>$.id==t.ProductID),y=()=>I.value==0?!0:I.value==1?t.Point>a.memberInfo.point:t.Point<a.memberInfo.point;return{...t,click:i!==-1,disabled:t.Quantity<1||t.Point>a.memberInfo.point,noPoint:t.Point>a.memberInfo.point,show:y()}})),T=S(()=>{let t=0;for(let i in v.arr)G(Number(i)),t+=v.arr[i].ToTal;return t}),ee=S(()=>a.memberInfo.point>=T.value?"":l("RedemptionRewards.Rewardlist.errMes"));be(()=>p.value,t=>{t&&(Q.value=!1)});const te=()=>{a.setMemberInfo(a.nullMemberInfo)},se=()=>{a.setMemberInfo(a.nullMemberInfo)},G=t=>{v.arr[t].ToTal=v.arr[t].Point*v.arr[t].Quantity},L=()=>{v.arr=[]},oe=()=>{a.memberInfo.point>=T.value&&(b.step=1,b.value=!0,b.title=l("RedemptionRewards.Rewardlist.popValue.title"),b.css="redem-pop",b.content="")},ne=()=>{b.step=2,b.value=!0,b.content=l("RedemptionRewards.Rewardlist.popValue.success"),b.css="redem-pop",a.memberInfo.point=a.memberInfo.point-T.value,a.setMemberInfo(a.memberInfo)},ae=()=>{L(),k()},j=t=>{Q.value=t},le=()=>{},ie=()=>{},re=t=>{a.setMemberInfo(t),ce()},ce=()=>{const t=i=>{i.isSuccess&&(q.arr=i.data)};m.clientTest&&fe.GetRetrieveSuccess().then(i=>{t(i)})},de=(t,i)=>{I.value=i},ue=(t,i)=>{if(!t.click&&!t.disabled)v.arr.push({id:t.ProductID,Productname:t.InvoiceNo,Quantity:1,Point:t.Point,ToTal:t.Point});else if(t.click&&!t.disabled){let y=v.arr.findIndex($=>$.id==t.ProductID);v.arr.splice(y,1)}},me=t=>{v.arr.splice(t,1)};return B(()=>{te()}),(t,i)=>{const y=M("el-input");return c(),u("div",{class:d([n(o)&&"reward-page"])},[e("div",ft,[w(ve,{value:n(h),closeTable:n(o),onSearch:se,onClick:re},null,8,["value","closeTable"]),n(o)?(c(),C(ye,{key:0})):_("",!0),n(o)?(c(),C(Oe,{key:1,tableData:v.arr,total:n(T),mes:n(ee),onKeyup:G,onDel:me,onClean:L,onSubmit:oe},null,8,["tableData","total","mes"])):_("",!0)]),!n(p)&&n(o)?(c(),u("div",{key:0,class:"fixed-tag-box",onClick:i[0]||(i[0]=$=>j(!0))},s(t.$t("RedemptionRewards.Rewardlist.field.Product")),1)):_("",!0),n(o)?x((c(),u("div",{key:1,class:d(["rigth",!n(p)&&"popup-background"])},[e("div",{class:d([!n(p)&&"rigth-box"])},[e("div",vt,[x(e("i",{class:"fas fa-times",onClick:i[1]||(i[1]=$=>j(!1))},null,512),[[z,!n(p)]])]),e("div",_t,[e("label",null,s(t.$t("RedemptionRewards.Rewardlist.search")),1),w(y,{class:d(["p100-input"]),modelValue:H.value,"onUpdate:modelValue":i[3]||(i[3]=$=>H.value=$),placeholder:"Please input"},{append:g(()=>[e("i",{class:"fas fa-search",onClick:i[2]||(i[2]=$=>le())})]),_:1},8,["modelValue"])]),e("div",ht,[w(_e,{items:X,value:Z.value,label:t.$t("RedemptionRewards.Rewardlist.filter"),onChange:i[4]||(i[4]=$=>ie())},null,8,["value","label"])]),w(he,{items:n(Y),onClick:de},null,8,["items"]),n(U).length>0&&n(o)?(c(),C(nt,{key:0,items:n(U),onClick:ue},null,8,["items"])):_("",!0)],2)],2)),[[z,n(p)||Q.value]]):_("",!0),w(bt,{pop:n(b),point:n(a).memberInfo.point?n(a).memberInfo.point:0,onCheck:ne,onBack:n(k),onSaveBack:ae},null,8,["pop","point","onBack"])],2)}}});export{Ct as default};
